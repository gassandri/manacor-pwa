<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#2f3137" />
  <title>Entrenamiento ¬∑ Fuerza + Potencia (Familia)</title>

  <style>
    :root{
      --bg1:#0b0d10;
      --bg2:#12151b;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.12);
      --text:#f5f5f5;
      --muted:#b9bcc6;
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --good:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --radius:18px;
      --focus: rgba(212,212,216,.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(255,255,255,.08), transparent 55%),
        radial-gradient(1000px 650px at 80% 20%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.20));
      border-bottom:1px solid var(--line);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 16px; }
    .topbar{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .subtitle{ color:var(--muted); font-size:13px; }

    main{ max-width:1100px; margin:0 auto; padding:16px; display:grid; gap:14px; }
    @media (min-width: 980px){
      main{ grid-template-columns: 1.25fr .75fr; align-items:start; }
    }

    .card{
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .inner{ padding:14px; }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .between{ justify-content:space-between; }
    .muted{ color:var(--muted); }
    .small{ font-size:13px; }
    .hidden{ display:none !important; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size:12px; color:#e5e7eb;
    }
    .dot{ width:8px; height:8px; border-radius:50%; background: rgba(255,255,255,.55); }
    .dot.good{ background: rgba(34,197,94,.95); }
    .dot.warn{ background: rgba(245,158,11,.95); }
    .dot.bad{ background: rgba(239,68,68,.95); }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:800;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, #e5e7eb, #a1a1aa);
      border:none; color:#111827; font-weight:900;
    }
    .btn.ghost{ background:transparent; }
    .btn.danger{ border-color: rgba(239,68,68,.35); color:#fecaca; }
    .btn.good{ border-color: rgba(34,197,94,.35); color:#bbf7d0; }

    /* SELECTS SIEMPRE LEGIBLES */
    select, input{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, #2a2a2a, #1f1f1f);
      color:#f5f5f5;
      outline:none;
      font-weight:700;
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
    }
    select:focus, input:focus{
      border-color: rgba(212,212,216,.55);
      box-shadow: 0 0 0 3px rgba(212,212,216,.12);
    }
    select option{ background:#1f1f1f; color:#f5f5f5; }

    .banner{
      padding:14px;
      background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .banner strong{ font-size:15px; }
    .quote{ font-size:18px; font-weight:950; margin-top:6px; letter-spacing:.2px; }
    .hint{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    .sessionCard{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      padding:14px;
    }
    .sessionCard h3{ margin:0 0 6px 0; font-size:16px; }
    .meta{ color:var(--muted); font-size:13px; line-height:1.35; }

    .progressWrap{ display:flex; gap:10px; align-items:center; width:100%; }
    .bar{
      flex:1; height:10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      overflow:hidden;
    }
    .fill{ height:100%; width:0%; background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(212,212,216,.85)); }
    .pct{ font-size:12px; color:var(--muted); min-width:92px; text-align:right; }

    table{ width:100%; border-collapse:collapse; }
    th, td{ padding:10px; border-bottom:1px solid rgba(255,255,255,.10); vertical-align:top; }
    th{ font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); text-align:left; }
    a{ color:#e5e7eb; }
    a:hover{ color:white; }

    .check{ transform: scale(1.2); accent-color: #d4d4d8; cursor:pointer; }

    .right .card{ position:sticky; top:86px; }
    .kpi{ display:grid; gap:10px; grid-template-columns:1fr 1fr; }
    .kpi .box{
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      background: rgba(255,255,255,.04);
    }
    .kpi .val{ font-size:18px; font-weight:950; }
    .kpi .lab{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.08em; }
    .sep{ height:1px; background: rgba(255,255,255,.10); margin:12px 0; }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color:var(--muted); font-size:12px;
    }

    /* Timer button y details */
    .timerBtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight:900;
      color:#fff;
    }
    .timerBtn:hover{ background: rgba(255,255,255,.12); }
    details summary{
      cursor:pointer;
      color:#e5e7eb;
      font-weight:900;
    }
    details{ margin-top:8px; }

    /* Modal timer */
    #timerModal{
      position:fixed; inset:0; z-index:9999;
      background:rgba(0,0,0,.55); backdrop-filter: blur(8px);
      display:none; align-items:center; justify-content:center; padding:16px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Planes de Entrenamiento ¬∑ Fuerza + Potencia</h1>
        <div class="subtitle">3 perfiles ¬∑ 4 d√≠as/semana ¬∑ progreso semanal ¬∑ timer ¬∑ notas ¬∑ progresi√≥n</div>
      </div>
      <div class="row">
        <span class="pill" id="profilePill"><span class="dot"></span> Perfil: ‚Äî</span>
        <button class="btn ghost" id="switchProfileBtn">Cambiar perfil</button>
      </div>
    </div>
  </div>
</header>

<main>
  <section style="display:grid; gap:14px">

    <!-- Motivaci√≥n -->
    <div class="card" id="motivationCard">
      <div class="banner">
        <strong class="muted small">Mensaje</strong>
        <div class="quote" id="motivationText">‚Äî</div>
      </div>
      <div class="hint row between">
        <span>Tip: si la velocidad o t√©cnica cae, <b>par√°s</b>. Calidad primero.</span>
        <button class="btn" id="newMotivationBtn">Nuevo mensaje</button>
      </div>
    </div>

    <!-- Selector de perfil -->
    <div class="card" id="profileView">
      <div class="inner">
        <div class="row between">
          <div>
            <div style="font-weight:950;font-size:16px">Elegir usuario</div>
            <div class="muted small" id="profileInfo" style="margin-top:4px">‚Äî</div>
          </div>
          <span class="pill"><span class="dot good"></span> Listo</span>
        </div>

        <div class="sep"></div>

        <div class="row">
          <select id="profileSelect"></select>
          <button class="btn primary" id="enterBtn">Entrar</button>
          <span class="tag">Se guarda en este dispositivo</span>
        </div>
      </div>
    </div>

    <!-- App -->
    <div class="card hidden" id="appView">
      <div class="inner">
        <div class="row between">
          <div>
            <div id="planTitle" style="font-weight:950;font-size:18px">‚Äî</div>
            <div id="planSubtitle" class="muted small">‚Äî</div>
          </div>
          <div class="row">
            <span class="muted small">Semana</span>
            <select id="weekSelect"></select>
            <button class="btn" id="homeBtn">Plan semanal</button>
            <button class="btn danger" id="resetBtn">Reset semana</button>
          </div>
        </div>

        <div class="sep"></div>

        <!-- HOME -->
        <div id="homeView"></div>

        <!-- SESSION -->
        <div id="sessionView" class="hidden">
          <div class="sessionCard">
            <h3 id="sessionTitle">‚Äî</h3>
            <div class="meta" id="sessionObjective">‚Äî</div>
            <div class="hint" id="progressionHint" style="border-top:none; padding:10px 0 0 0;"></div>

            <div class="sep"></div>

            <div class="row between">
              <div class="row">
                <span class="pill"><span class="dot warn"></span> Parar si hay dolor</span>
                <span class="tag" id="sessionTimeTag">~60 min</span>
              </div>
              <div class="row">
                <button class="btn good" id="completeSessionBtn">‚úÖ Completar sesi√≥n</button>
                <button class="btn" id="backBtn">‚Üê Volver</button>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <div style="padding:0; overflow:hidden">
              <table>
                <thead>
                  <tr>
                    <th>‚úî</th>
                    <th>Ejercicio + descripci√≥n</th>
                    <th>Series</th>
                    <th>Reps/tiempo</th>
                    <th>Descanso</th>
                    <th>V√≠deo</th>
                  </tr>
                </thead>
                <tbody id="exerciseTable"></tbody>
              </table>
            </div>
          </div>

          <div class="hint">
            Fuerza: termina con <b>1‚Äì3 reps en reserva</b>. Velocidad/saltos: <b>descanso completo</b>.
          </div>
        </div>
      </div>
    </div>

    <!-- Error real -->
    <div class="card hidden" id="errorView">
      <div class="inner">
        <div style="font-weight:950;font-size:16px">Error real en la app</div>
        <div class="muted small" id="errorText" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <aside class="right" style="display:grid; gap:14px">
    <div class="card">
      <div class="inner">
        <div style="font-weight:950;font-size:16px">Panel</div>
        <div class="muted small" style="margin-top:4px">Progreso y recordatorios.</div>

        <div class="sep"></div>

        <div class="kpi">
          <div class="box">
            <div class="val" id="kpiProfile">‚Äî</div>
            <div class="lab">perfil</div>
          </div>
          <div class="box">
            <div class="val" id="kpiWeek">‚Äî</div>
            <div class="lab">semana</div>
          </div>
          <div class="box">
            <div class="val" id="kpiWeeklyPct">‚Äî</div>
            <div class="lab">progreso</div>
          </div>
          <div class="box">
            <div class="val">4</div>
            <div class="lab">d√≠as</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="small muted" style="line-height:1.5">
          <b>Juancho:</b> optimizado para club (L/M/J/V ~18) y partido s√°bado.<br>
          <b>Benja:</b> masa + explosi√≥n + prevenci√≥n (ma√±anas).<br>
          <b>Gaston:</b> ‚Äúmodo juego‚Äù, t√©cnica + fuerza segura.
        </div>

      </div>
    </div>
  </aside>
</main>

<!-- MODAL CRON√ìMETRO -->
<div id="timerModal">
  <div class="card" style="max-width:520px; width:100%;">
    <div class="inner">
      <div class="row between">
        <div>
          <div style="font-weight:950;font-size:16px">Cron√≥metro de descanso</div>
          <div class="muted small" id="timerExerciseName">‚Äî</div>
        </div>
        <button class="btn" id="timerCloseBtn">Cerrar</button>
      </div>

      <div class="sep"></div>

      <div style="font-size:44px; font-weight:950; text-align:center; letter-spacing:.5px" id="timerDisplay">00:00</div>

      <div class="row" style="justify-content:center; margin-top:10px">
        <button class="btn" id="timerStartBtn">‚ñ∂ Iniciar</button>
        <button class="btn" id="timerPauseBtn">‚è∏ Pausa</button>
        <button class="btn danger" id="timerResetBtn">‚Ü∫ Reset</button>
      </div>

      <div class="sep"></div>

      <div class="row" style="justify-content:center">
        <button class="btn" data-tsec="30">30s</button>
        <button class="btn" data-tsec="60">60s</button>
        <button class="btn" data-tsec="90">90s</button>
        <button class="btn" data-tsec="120">2m</button>
      </div>

      <div class="hint" style="margin-top:12px">
        Tip: en sprints y saltos, espera a sentirte <b>listo</b> (descanso completo).
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ============================
  // ESTADO
  // ============================
  let ACTIVE_PROFILE = null;
  let ACTIVE_SESSION_ID = null;

  // ============================
  // MOTIVACI√ìN
  // ============================
  const MOTIVATION = [
    "Disciplina > motivaci√≥n. Hoy sumas una victoria silenciosa.",
    "Peque√±as mejoras cada d√≠a = resultados enormes en meses.",
    "Entrena como quieres jugar: fuerte, r√°pido y valiente.",
    "No compitas con otros: compite con tu versi√≥n de ayer.",
    "Calidad primero. Cada repetici√≥n cuenta.",
    "Cuando no apetece‚Ä¶ es cuando m√°s vale hacerlo.",
    "Tu futuro jugador empieza con tu esfuerzo de hoy.",
    "El talento abre puertas. La constancia las mantiene abiertas.",
    "Acelera con la mente, explota con el cuerpo.",
    "El trabajo bien hecho se nota el s√°bado."
  ];

  // ============================
  // PERFILES
  // ============================
  const PROFILES = {
    juancho: {
      name: "JUANCHO",
      info: "15 a√±os ¬∑ Cadete auton√≥mico ¬∑ Velocidad + explosi√≥n sin perder masa"
    },
    benja: {
      name: "BENJA",
      info: "17 a√±os ¬∑ 182cm ¬∑ 65kg ¬∑ Masa muscular + explosi√≥n + prevenci√≥n (ma√±anas libres)"
    },
    gaston: {
      name: "GASTON",
      info: "9 a√±os ¬∑ 143cm ¬∑ 38kg ¬∑ Coordinaci√≥n + velocidad + fuerza b√°sica segura"
    }
  };

  // ============================
  // HELPERS EJERCICIO
  // ============================
  function ex(id, name, desc, sets, reps, rest, url, keys, errors){
    return { id, name, desc, sets, reps, rest, url, keys, errors };
  }

  // ============================
  // PLANES (4 d√≠as por perfil)
  // ============================
  const PLANS = {
    juancho: [
      {
        id:"mon", dayLabel:"Lunes", title:"Fuerza + potencia (pierna)",
        objective:"Base de fuerza + transferir a salto/sprint (sin fatigar para el club).",
        approx:"55‚Äì60 min",
        exercises:[
          ex("mob","Movilidad din√°mica (cadera/tobillo)","Movilidad suave, sin dolor. 60‚Äì90s por zona.","‚Äî","5‚Äì6 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Rango sin dolor. Respira. Movimientos controlados.","Apurar y rebotar, dolor en rodilla/tobillo."),
          ex("act","Activaci√≥n gl√∫teo + core","Monster walks + dead bug suave. Activar, no quemar.","2","10‚Äì12","30‚Äì45s","https://www.youtube.com/watch?v=0a6yJv6u5RQ",
             "Tensi√≥n en gl√∫teo, cintura estable.","Caderas se giran, banda muy floja."),
          ex("box","Saltos al caj√≥n","Saltos explosivos. Aterriza suave, rodilla alineada.","4","3","90s","https://www.youtube.com/watch?v=52r_Ul5k03g",
             "Pocos y perfectos. Ca√≠da silenciosa.","Hacer muchos y perder altura/t√©cnica."),
          ex("sq","Sentadilla con barra","Fuerte y t√©cnico. 1‚Äì2 reps en reserva.","4","4‚Äì5","2‚Äì3m","https://www.youtube.com/watch?v=ultWZbUMPL8",
             "Espalda neutra. Rodilla acompa√±a pie.","Rebotar abajo, talones se levantan."),
          ex("ht","Hip thrust","Gl√∫teo potente para aceleraci√≥n.","3","5‚Äì6","2m","https://www.youtube.com/watch?v=LM8XHLYJoYs",
             "Pausa 1s arriba, pelvis neutra.","Hiperextender lumbar."),
          ex("rdl","Peso muerto rumano","Isquios fuertes = sprint + prevenci√≥n.","3","6‚Äì8","2m","https://www.youtube.com/watch?v=2SHsk9AzdjA",
             "Bisagra de cadera, barra cerca.","Redondear espalda, bajar de m√°s."),
          ex("mb","Bal√≥n medicinal (pecho)","Lanzamiento explosivo contra pared.","3","5","60‚Äì90s","https://www.youtube.com/watch?v=V8g6dXKjN5A",
             "Explosivo, sin arquear espalda.","Lanzar lento, compensar con lumbar."),
          ex("cool","Vuelta a la calma","Respiraci√≥n + estiramiento suave.","‚Äî","5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar pulsaciones.","Estirar fuerte con dolor.")
        ]
      },
      {
        id:"tue", dayLabel:"Martes", title:"Velocidad + pliometr√≠a + cardio suave",
        objective:"Aceleraci√≥n (10‚Äì20m) + reactividad. Termina con cardio suave para recuperar.",
        approx:"55‚Äì60 min",
        exercises:[
          ex("warm","Calentamiento carrera","Trote suave + skipping + talones.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Subir temperatura. T√©cnica ligera.","Arrancar a tope sin calentar."),
          ex("pogo","Pogos reactivos","Rebotes cortos, poco tiempo en suelo.","3","15‚Äì20","60s","https://www.youtube.com/watch?v=R1JYx6zJ2Ys",
             "Tobillo r√≠gido, torso alto.","Flexionar mucho rodilla y perder rebote."),
          ex("bounds","Bounds","Potencia horizontal. Zancada el√°stica.","4","20‚Äì25m","90s","https://www.youtube.com/watch?v=9jP5ZL5D6Y0",
             "Empujar el suelo, mantener ritmo.","Caer pesado, perder coordinaci√≥n."),
          ex("sprint","Sprints 10‚Äì20m","M√°xima calidad. Descanso completo.","6","1","2‚Äì3m","https://www.youtube.com/watch?v=YkqvJvGz5gM",
             "Salida agresiva, t√©cnica limpia.","Hacerlos fatigado y m√°s lento."),
          ex("lad","Escalera agilidad","4 patrones simples.","2","4 patrones","60s","https://www.youtube.com/watch?v=R5JpU9JmG8k",
             "Pies r√°pidos, postura estable.","Mirar al suelo y encorvarse."),
          ex("z2","Cardio Z2 (bici/spinning)","Suave: puedes hablar.","‚Äî","12‚Äì15 min","‚Äî","https://www.youtube.com/watch?v=R5m8p3E4b2c",
             "Recuperaci√≥n activa.","Pasarte de intensidad."),
          ex("cool","Vuelta a la calma","Respirar + movilidad suave.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Soltar tensi√≥n.","Cortar en seco.")
        ]
      },
      {
        id:"thu", dayLabel:"Jueves", title:"Unilateral + prevenci√≥n + core",
        objective:"Equilibrar piernas, prevenir lesiones y mantener potencia sin reventarse.",
        approx:"55‚Äì60 min",
        exercises:[
          ex("mob","Movilidad + activaci√≥n","Cadera/tobillo + banda gl√∫teo medio.","‚Äî","8 min","‚Äî","https://www.youtube.com/watch?v=0a6yJv6u5RQ",
             "Activar sin fatigar.","Banda muy ligera, no siente gl√∫teo."),
          ex("bulg","Split squat b√∫lgaro","Pierna a pierna. Control.","3","5/pierna","2m","https://www.youtube.com/watch?v=2C-uNgKwPLE",
             "Rodilla alineada, tronco estable.","Caer hacia adentro."),
          ex("step","Step-up explosivo","Sube r√°pido, baja controlado.","3","4/pierna","90s","https://www.youtube.com/watch?v=9LIAhxQHmak",
             "Impulsar desde la pierna de apoyo.","Empujar con la de atr√°s."),
          ex("nord","Nordic curl","Prevenci√≥n isquios. Poco volumen.","2‚Äì3","3‚Äì5","2‚Äì3m","https://www.youtube.com/watch?v=4b6G2P0wC5I",
             "Control, rango progresivo.","Bajar de golpe y tironear isquio."),
          ex("coph","Copenhagen","Aductor fuerte.","2","20‚Äì30s/lado","60‚Äì90s","https://www.youtube.com/watch?v=1n9uG8f6u9k",
             "Cadera alta y estable.","Cadera cae y duele la ingle."),
          ex("core","Pallof press","Anti-rotaci√≥n.","3","10‚Äì12/lado","60s","https://www.youtube.com/watch?v=I7bqH2b4ZzQ",
             "Costillas abajo, tronco firme.","Girar el cuerpo en vez de resistir."),
          ex("cool","Vuelta a la calma","Soltar + respirar.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar tensi√≥n.","Estirar agresivo.")
        ]
      },
      {
        id:"sat", dayLabel:"S√°bado", title:"Activaci√≥n pre-partido (chispa)",
        objective:"Activar SNC y articulaciones sin fatiga. Ideal 45‚Äì70 min antes del partido.",
        approx:"45‚Äì60 min",
        exercises:[
          ex("warm","Movilidad + trote suave","Movilidad general + trote 5‚Äì6 min.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Entrar en calor suave.","Llegar fr√≠o al sprint."),
          ex("band","Band activation","Gl√∫teo medio + cadera.","2","10‚Äì12","30s","https://www.youtube.com/watch?v=0a6yJv6u5RQ",
             "Sensaci√≥n de ‚Äòencendido‚Äô.","Fatigar con mil repeticiones."),
          ex("react","Saltos reactivos","Pocos, explosivos.","3","3","60‚Äì90s","https://www.youtube.com/watch?v=R1JYx6zJ2Ys",
             "Explosi√≥n y frescura.","Convertirlo en cardio."),
          ex("s10","Sprints 5‚Äì10m","Arranques r√°pidos.","4","1","90s","https://www.youtube.com/watch?v=J1xN3O1tEJk",
             "Descanso completo.","Hacerlos cansado."),
          ex("cod","COD corto","T√©cnico, sin quemarte.","3","2‚Äì3","60‚Äì90s","https://www.youtube.com/watch?v=3Zf7U0sP9kM",
             "Frenar bajo control.","Rodilla colapsa hacia dentro."),
          ex("finish","Bal√≥n 2‚Äì3 min","Toques suaves, ‚Äòsentir‚Äô bal√≥n.","‚Äî","2‚Äì3 min","‚Äî","https://www.youtube.com/watch?v=8lQvKq1iDkQ",
             "Conectar con el juego.","Llegar agitado.")
        ]
      }
    ],

    benja: [
      {
        id:"mon", dayLabel:"Lunes", title:"Pierna (masa) + potencia",
        objective:"Hipertrofia inteligente + chispa (sin destruirlo).",
        approx:"55‚Äì60 min",
        exercises:[
          ex("warm","Bici + movilidad","Bici 5 min + movilidad cadera/tobillo.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Subir temperatura.","Arrancar pesado en fr√≠o."),
          ex("jump","Saltos al caj√≥n","Potencia primero. Pocos y perfectos.","4","3","90s","https://www.youtube.com/watch?v=52r_Ul5k03g",
             "Altura segura, t√©cnica.","Fatiga y mala ca√≠da."),
          ex("sq","Sentadilla con barra","Masa: control + rango.","4","6","2‚Äì3m","https://www.youtube.com/watch?v=ultWZbUMPL8",
             "Ritmo controlado.","Rebotar y perder postura."),
          ex("ht","Hip thrust","Gl√∫teo grande y fuerte.","4","8","2m","https://www.youtube.com/watch?v=LM8XHLYJoYs",
             "Pausa arriba 1s.","Hiperextender lumbar."),
          ex("rdl","RDL","Isquio fuerte.","3","8","2m","https://www.youtube.com/watch?v=2SHsk9AzdjA",
             "Barra pegada, bisagra.","Doblar espalda."),
          ex("calf","Gemelos","Tobillo fuerte.","3","10‚Äì12","60‚Äì90s","https://www.youtube.com/watch?v=YMmgqO8Jo-k",
             "Rango completo.","Rebotar sin control."),
          ex("cool","Vuelta a la calma","Respirar + estirar suave.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar pulsaciones.","Salir sin soltar.")
        ]
      },
      {
        id:"tue", dayLabel:"Martes", title:"Tren superior (masa) + core",
        objective:"Ganar masa arriba + estabilidad del tronco.",
        approx:"55‚Äì60 min",
        exercises:[
          ex("warm","Activaci√≥n hombro/esc√°pula","Band pull-aparts + movilidad.","‚Äî","8 min","‚Äî","https://www.youtube.com/watch?v=3w8yQm3gJ8c",
             "Esc√°pulas activas.","Hombros hacia orejas."),
          ex("bench","Press banca","Masa: no al fallo.","4","6‚Äì8","2‚Äì3m","https://www.youtube.com/watch?v=rT7DgCr-3pg",
             "Pies firmes, control.","Rebotar barra en pecho."),
          ex("pull","Dominadas","6‚Äì8 reps controladas.","4","6‚Äì8","2‚Äì3m","https://www.youtube.com/watch?v=eGo4IYlbE5g",
             "Pecho a barra si puede.","Balanceo excesivo."),
          ex("row","Remo","Espalda fuerte.","3","8‚Äì10","90‚Äì120s","https://www.youtube.com/watch?v=vT2GjY_Umpw",
             "Codo atr√°s, torso estable.","Tirar con b√≠ceps solo."),
          ex("mb","Med ball chest pass","Potencia tren superior.","4","5","60‚Äì90s","https://www.youtube.com/watch?v=V8g6dXKjN5A",
             "Explosivo y corto.","Lanzar lento."),
          ex("pall","Pallof press","Anti-rotaci√≥n.","3","10‚Äì12/lado","60s","https://www.youtube.com/watch?v=I7bqH2b4ZzQ",
             "Core firme.","Rotar el tronco."),
          ex("cool","Vuelta a la calma","Movilidad tor√°cica + respiraci√≥n.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Soltar tensi√≥n.","Cortar en seco.")
        ]
      },
      {
        id:"thu", dayLabel:"Jueves", title:"Prevenci√≥n + aceleraci√≥n (chispa)",
        objective:"Velocidad + blindaje isquio/aductor/tibial.",
        approx:"55‚Äì60 min",
        exercises:[
          ex("warm","Calentamiento carrera","Trote + t√©cnica (A-skips).","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Preparar para sprint.","Arrancar a tope sin calentar."),
          ex("sprint","Sprints 10‚Äì20m","M√°xima calidad.","6","1","2‚Äì3m","https://www.youtube.com/watch?v=YkqvJvGz5gM",
             "Descanso completo.","Hacerlos fatigado."),
          ex("bulg","B√∫lgaro","Masa unilateral + estabilidad.","3","8/pierna","2m","https://www.youtube.com/watch?v=2C-uNgKwPLE",
             "Rodilla alineada.","Caer hacia dentro."),
          ex("nord","Nordic curl","Isquio fuerte.","3","3‚Äì5","2‚Äì3m","https://www.youtube.com/watch?v=4b6G2P0wC5I",
             "Rango progresivo.","Tir√≥n brusco."),
          ex("coph","Copenhagen","Aductor fuerte.","2‚Äì3","20‚Äì30s/lado","60‚Äì90s","https://www.youtube.com/watch?v=1n9uG8f6u9k",
             "Cadera alta.","Dolor agudo en ingle."),
          ex("tib","Tibial raises","Tobillo/rodilla.","2","15‚Äì20","45‚Äì60s","https://www.youtube.com/watch?v=6C9Yp1m8wYw",
             "Control y rango.","Rebotar sin control."),
          ex("cool","Vuelta a la calma","Respirar + soltar piernas.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Recuperar.","Salir sin soltar.")
        ]
      },
      {
        id:"sat", dayLabel:"S√°bado", title:"Cardio Z2 + movilidad (recuperaci√≥n)",
        objective:"Mejorar recuperaci√≥n y base aer√≥bica sin machacar piernas.",
        approx:"55‚Äì60 min",
        exercises:[
          ex("z2","Cardio Z2 (bici/spinning)","RPE 3‚Äì4/10. Conversaci√≥n posible.","‚Äî","35‚Äì40 min","‚Äî","https://www.youtube.com/watch?v=R5m8p3E4b2c",
             "Constante, sin picos.","Ir demasiado fuerte."),
          ex("mob","Movilidad cadera/tobillo","Suave y controlado.","‚Äî","10‚Äì12 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Rango sin dolor.","Forzar."),
          ex("core","Core suave","Dead bug + plancha lateral.","2","8‚Äì10 + 20s","45‚Äì60s","https://www.youtube.com/watch?v=pSHjTRCQxIw",
             "Calidad.","Fatigarse demasiado."),
          ex("breath","Respiraci√≥n","Bajar pulsaciones.","‚Äî","3‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Relajar.","Cortar r√°pido.")
        ]
      }
    ],

    gaston: [
      {
        id:"mon", dayLabel:"Lunes", title:"Coordinaci√≥n + fuerza b√°sica (juego)",
        objective:"Moverse bien y fuerte sin cargas pesadas. Divertido y seguro.",
        approx:"50‚Äì60 min",
        exercises:[
          ex("warm","Juego + movilidad","Saltitos + movilidad tobillo/cadera.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Calentar jugando.","Empezar sin calentar."),
          ex("lad","Escalera agilidad","3‚Äì4 patrones simples.","3","3‚Äì4 patrones","45‚Äì60s","https://www.youtube.com/watch?v=R5JpU9JmG8k",
             "R√°pido y divertido.","Tropezar por ir sin control."),
          ex("squat","Sentadilla peso corporal","Rodilla alineada.","3","10‚Äì12","60s","https://www.youtube.com/watch?v=aclHkVaku9U",
             "Espalda neutra.","Rodillas se meten."),
          ex("push","Flexiones (en banco si hace falta)","T√©cnica primero.","3","6‚Äì10","60‚Äì90s","https://www.youtube.com/watch?v=IODxDxX7oi4",
             "Cuerpo recto.","Cadera cae."),
          ex("hang","Colgarse barra","Agarre + espalda.","3","20‚Äì30s","60s","https://www.youtube.com/watch?v=eGo4IYlbE5g",
             "Juego, sin dolor.","Balanceo excesivo."),
          ex("plank","Plancha","Firme y corto.","3","20‚Äì30s","60s","https://www.youtube.com/watch?v=pSHjTRCQxIw",
             "Cadera neutra.","Cadera muy alta/baja."),
          ex("cool","Vuelta a la calma","Respirar + estirar suave.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar revoluciones.","Cortar de golpe.")
        ]
      },
      {
        id:"tue", dayLabel:"Martes", title:"Velocidad corta + saltos suaves",
        objective:"Arranques r√°pidos con t√©cnica + coordinaci√≥n.",
        approx:"50‚Äì60 min",
        exercises:[
          ex("warm","Calentar corriendo","Trote suave + skipping.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Preparar cuerpo.","Arrancar a lo loco."),
          ex("s10","Sprints 5‚Äì10m","Salidas, sin cansarse.","6","1","60‚Äì90s","https://www.youtube.com/watch?v=J1xN3O1tEJk",
             "R√°pido pero fresco.","Hacerlos agotado."),
          ex("pogo","Pogos suaves","Rebote corto y controlado.","3","10‚Äì15","60s","https://www.youtube.com/watch?v=R1JYx6zJ2Ys",
             "Control.","Muchos y mal."),
          ex("mb","Bal√≥n medicinal ligero","Lanzar con intenci√≥n.","3","6","60s","https://www.youtube.com/watch?v=V8g6dXKjN5A",
             "Explosivo y divertido.","Lanzar lento."),
          ex("game","Juego COD","Con conos: pilla-pilla 4x20s.","4","20s","60s","https://www.youtube.com/watch?v=3Zf7U0sP9kM",
             "Divertido.","Exceso de fatiga."),
          ex("cool","Vuelta a la calma","Respirar + movilidad.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar pulsaciones.","Cortar seco.")
        ]
      },
      {
        id:"thu", dayLabel:"Jueves", title:"Prevenci√≥n + t√©cnica con bal√≥n",
        objective:"Base fuerte para jugar m√°s y lesionarse menos.",
        approx:"50‚Äì60 min",
        exercises:[
          ex("warm","Movilidad + activaci√≥n","Cadera/tobillo + band gl√∫teo.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=0a6yJv6u5RQ",
             "Activar.","Fatigar."),
          ex("tib","Tibial raises","Tobillo fuerte.","2","12‚Äì15","45‚Äì60s","https://www.youtube.com/watch?v=6C9Yp1m8wYw",
             "Control.","Rebotar."),
          ex("calf","Gemelos","Prevenci√≥n.","2‚Äì3","12‚Äì15","45‚Äì60s","https://www.youtube.com/watch?v=YMmgqO8Jo-k",
             "Rango completo.","Acortar rango."),
          ex("side","Plancha lateral","Core lateral.","2‚Äì3","15‚Äì25s/lado","60s","https://www.youtube.com/watch?v=K2VljzCC16g",
             "Cadera alta.","Cadera cae."),
          ex("drib","T√©cnica con bal√≥n","Toques: interior/exterior (5x45s).","5","45s","30‚Äì45s","https://www.youtube.com/watch?v=8lQvKq1iDkQ",
             "Ritmo constante.","Perder control por ir r√°pido."),
          ex("cool","Vuelta a la calma","Respirar.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Relajar.","Cortar.")
        ]
      },
      {
        id:"sat", dayLabel:"S√°bado", title:"Circuito modo partido (divertido)",
        objective:"Activaci√≥n general y coordinaci√≥n, sin fatiga.",
        approx:"45‚Äì60 min",
        exercises:[
          ex("warm","Trote + movilidad","Preparar cuerpo.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=2L2lnxIcNmo",
             "Calentar.","Arrancar fuerte."),
          ex("lad2","Escalera r√°pida","2‚Äì3 patrones.","2‚Äì3","3 patrones","45‚Äì60s","https://www.youtube.com/watch?v=R5JpU9JmG8k",
             "Pies r√°pidos.","Tropezar."),
          ex("s52","Sprints 5‚Äì10m","4 arranques.","4","1","60‚Äì90s","https://www.youtube.com/watch?v=J1xN3O1tEJk",
             "Fresco.","Fatiga."),
          ex("jump","Saltos suaves","Pocos, buenos.","2","3","60s","https://www.youtube.com/watch?v=R1JYx6zJ2Ys",
             "Control.","Muchos."),
          ex("ball","Bal√≥n libre","Tiros/toques 8‚Äì10 min.","‚Äî","8‚Äì10 min","‚Äî","https://www.youtube.com/watch?v=8lQvKq1iDkQ",
             "Terminar feliz.","Agotarse."),
          ex("cool","Vuelta a la calma","Respirar.","‚Äî","4‚Äì5 min","‚Äî","https://www.youtube.com/watch?v=YlEr7G8c2Dk",
             "Bajar pulsaciones.","Cortar.")
        ]
      }
    ]
  };

  // ============================
  // STORAGE
  // ============================
  function getActiveProfile(){ return localStorage.getItem("activeProfile") || ""; }
  function setActiveProfile(id){ localStorage.setItem("activeProfile", id); }
  function weekKey(profile){ return `mpwa_${profile}_week`; }
  function getWeek(profile){ return Number(localStorage.getItem(weekKey(profile)) || "1"); }
  function setWeek(profile, w){ localStorage.setItem(weekKey(profile), String(w)); }
  function checkKey(profile, week, sessionId, exId){
    return `mpwa_${profile}_check_w${week}_${sessionId}_${exId}`;
  }

  // ============================
  // DOM
  // ============================
  const $ = (id) => document.getElementById(id);

  function showError(msg){
    $("errorText").textContent = msg;
    $("errorView").classList.remove("hidden");
  }

  // ============================
  // MOTIVACI√ìN
  // ============================
  function newMotivation(){
    const idx = Math.floor(Math.random()*MOTIVATION.length);
    $("motivationText").textContent = MOTIVATION[idx];
  }

  // ============================
  // PROGRESI√ìN (texto semana 1‚Äì6)
  // ============================
  function getProgressionText(profile, week){
    if (week <= 1) return "Semana 1: base t√©cnica + calidad. Nada al fallo.";

    if (profile === "benja"){
      if (week === 2) return "Semana 2: +1 rep por serie en ejercicios de masa si mantienes t√©cnica.";
      if (week === 3) return "Semana 3: +1 serie en 1 ejercicio principal (pierna o banca) o +2 reps totales.";
      if (week === 4) return "Semana 4 (deload): baja 15‚Äì25% el volumen para recuperar y crecer.";
      if (week === 5) return "Semana 5: vuelve a Semana 3 con mejor control/velocidad.";
      return "Semana 6: mejor semana con t√©cnica perfecta (sin fallo).";
    }

    if (profile === "juancho"){
      if (week === 2) return "Semana 2: misma carga, mejor velocidad. Si f√°cil: +2.5‚Äì5% solo en 1 ejercicio.";
      if (week === 3) return "Semana 3: +1 serie en prevenci√≥n o +1 sprint, SIN fatiga.";
      if (week === 4) return "Semana 4 (deload): reduce volumen 20% para llegar m√°s r√°pido al partido.";
      if (week === 5) return "Semana 5: calidad m√°xima en sprints/saltos. Descanso completo.";
      return "Semana 6: mismo volumen, mejor ejecuci√≥n. Objetivo: chispa y frescura.";
    }

    // Gaston
    if (week === 2) return "Semana 2: +1 ronda de juego/t√©cnica o +5s de plancha si sale perfecto.";
    if (week === 3) return "Semana 3: mejor coordinaci√≥n (mejor ritmo), no m√°s cansancio.";
    if (week === 4) return "Semana 4: semana f√°cil: t√©cnica suave + diversi√≥n.";
    if (week === 5) return "Semana 5: repite Semana 3 con mejor control.";
    return "Semana 6: semana estrella: calidad, sonrisas y t√©cnica.";
  }

  // ============================
  // PROGRESO
  // ============================
  function getProfileSessions(profile){
    return PLANS[profile] || [];
  }

  function getSessionProgress(profile, sessionId){
    const w = getWeek(profile);
    const sess = getProfileSessions(profile).find(s => s.id === sessionId);
    if (!sess) return {done:0,total:0,pct:0};

    const total = sess.exercises.length;
    let done = 0;
    sess.exercises.forEach(e=>{
      if (localStorage.getItem(checkKey(profile, w, sessionId, e.id)) === "1") done++;
    });
    const pct = total ? Math.round((done/total)*100) : 0;
    return {done,total,pct};
  }

  function getWeeklyProgress(profile){
    const sessions = getProfileSessions(profile);
    let total = 0, done = 0;
    sessions.forEach(s=>{
      const p = getSessionProgress(profile, s.id);
      total += p.total;
      done += p.done;
    });
    const pct = total ? Math.round((done/total)*100) : 0;
    return {done,total,pct};
  }

  // ============================
  // TIMER: parse descanso
  // ============================
  function restToSeconds(restStr){
    if (!restStr) return 60;
    const s = String(restStr).toLowerCase().trim();
    if (s === "‚Äî" || s === "-") return 60;

    const rangeM = s.match(/(\d+)\s*[‚Äì-]\s*(\d+)\s*m/);
    if (rangeM) return parseInt(rangeM[1],10) * 60;

    const rangeS = s.match(/(\d+)\s*[‚Äì-]\s*(\d+)\s*s/);
    if (rangeS) return parseInt(rangeS[1],10);

    const m = s.match(/(\d+)\s*m/);
    if (m) return parseInt(m[1],10) * 60;

    const sec = s.match(/(\d+)\s*s/);
    if (sec) return parseInt(sec[1],10);

    const n = s.match(/(\d+)/);
    return n ? parseInt(n[1],10) : 60;
  }

  // ============================
  // TIMER: modal
  // ============================
  let timerInterval = null;
  let timerRemaining = 0;
  let timerRunning = false;

  function fmtTime(t){
    const mm = Math.floor(t/60);
    const ss = t % 60;
    return String(mm).padStart(2,"0") + ":" + String(ss).padStart(2,"0");
  }

  function openTimer(exName, seconds){
    $("timerExerciseName").textContent = exName || "Descanso";
    timerRemaining = Math.max(0, seconds || 60);
    timerRunning = false;
    $("timerDisplay").textContent = fmtTime(timerRemaining);
    const modal = $("timerModal");
    modal.style.display = "flex";
  }

  function closeTimer(){
    stopTimer();
    $("timerModal").style.display = "none";
  }

  function startTimer(){
    if (timerRunning) return;
    timerRunning = true;
    timerInterval = setInterval(() => {
      timerRemaining = Math.max(0, timerRemaining - 1);
      $("timerDisplay").textContent = fmtTime(timerRemaining);
      if (timerRemaining <= 0){
        stopTimer();
        try { navigator.vibrate && navigator.vibrate([80,60,80]); } catch(e){}
      }
    }, 1000);
  }

  function stopTimer(){
    timerRunning = false;
    if (timerInterval){ clearInterval(timerInterval); timerInterval = null; }
  }

  function resetTimer(){
    stopTimer();
    $("timerDisplay").textContent = fmtTime(timerRemaining);
  }

  function initTimerUI(){
    $("timerCloseBtn").onclick = closeTimer;
    $("timerStartBtn").onclick = startTimer;
    $("timerPauseBtn").onclick = stopTimer;
    $("timerResetBtn").onclick = resetTimer;

    $("timerModal").querySelectorAll("[data-tsec]").forEach(btn => {
      btn.addEventListener("click", () => {
        timerRemaining = parseInt(btn.getAttribute("data-tsec"), 10);
        $("timerDisplay").textContent = fmtTime(timerRemaining);
      });
    });

    // click fuera
    $("timerModal").addEventListener("click", (e) => {
      if (e.target === $("timerModal")) closeTimer();
    });
  }

  // ============================
  // UI: selectors
  // ============================
  function fillProfileSelect(){
    const ps = $("profileSelect");
    ps.innerHTML = "";
    Object.keys(PROFILES).forEach(id=>{
      const opt = document.createElement("option");
      opt.value = id;
      opt.textContent = PROFILES[id].name;
      ps.appendChild(opt);
    });
    ps.addEventListener("change", () => {
      const id = ps.value;
      $("profileInfo").textContent = PROFILES[id]?.info || "‚Äî";
    });
    $("profileInfo").textContent = PROFILES[ps.value]?.info || "‚Äî";
  }

  function fillWeekSelect(profile){
    const ws = $("weekSelect");
    ws.innerHTML = "";
    [1,2,3,4,5,6].forEach(w=>{
      const opt = document.createElement("option");
      opt.value = String(w);
      opt.textContent = String(w);
      ws.appendChild(opt);
    });
    ws.value = String(getWeek(profile));
  }

  function setProfilePill(profile){
    $("profilePill").innerHTML = `<span class="dot good"></span> Perfil: ${PROFILES[profile]?.name || "‚Äî"}`;
  }

  function updateKPIs(profile){
    $("kpiProfile").textContent = PROFILES[profile]?.name || "‚Äî";
    $("kpiWeek").textContent = String(getWeek(profile) || "‚Äî");
    const wk = getWeeklyProgress(profile);
    $("kpiWeeklyPct").textContent = wk.pct + "%";
  }

  function showProfileView(){
    $("profileView").classList.remove("hidden");
    $("appView").classList.add("hidden");
    $("sessionView").classList.add("hidden");
  }

  function showAppView(){
    $("profileView").classList.add("hidden");
    $("appView").classList.remove("hidden");
  }

  // ============================
  // HOME
  // ============================
  function renderHome(profile){
    $("sessionView").classList.add("hidden");
    const home = $("homeView");
    home.innerHTML = "";

    const week = getWeek(profile);
    const sessions = getProfileSessions(profile);
    const wk = getWeeklyProgress(profile);

    $("planTitle").textContent = `Programa de ${PROFILES[profile].name}`;
    $("planSubtitle").textContent = `${PROFILES[profile].info} ¬∑ Semana ${week}`;

    // Progreso global + barra
    const top = document.createElement("div");
    top.className = "sessionCard";
    top.innerHTML = `
      <div class="row between">
        <span class="pill"><span class="dot good"></span> Semana ${week}</span>
        <span class="tag">Progreso semanal: <b>${wk.done}/${wk.total}</b> (${wk.pct}%)</span>
      </div>
      <div style="height:10px"></div>
      <div class="progressWrap">
        <div class="bar"><div class="fill" style="width:${wk.pct}%"></div></div>
        <div class="pct">${wk.pct}%</div>
      </div>
      <div class="hint" style="border-top:none; padding:10px 0 0 0;">
        üéØ <b>Progresi√≥n sugerida:</b> ${getProgressionText(profile, week)}
      </div>
    `;
    home.appendChild(top);

    // Tarjetas de los 4 d√≠as
    sessions.forEach(s=>{
      const p = getSessionProgress(profile, s.id);

      const card = document.createElement("div");
      card.className = "sessionCard";
      card.innerHTML = `
        <div class="row between">
          <div>
            <h3>${s.dayLabel} ¬∑ ${s.title}</h3>
            <div class="meta">${s.objective}</div>
          </div>
          <span class="tag">${s.approx}</span>
        </div>

        <div style="height:10px"></div>

        <div class="progressWrap">
          <div class="bar"><div class="fill" style="width:${p.pct}%"></div></div>
          <div class="pct">${p.done}/${p.total} ¬∑ ${p.pct}%</div>
        </div>

        <div class="row between" style="margin-top:12px">
          <button class="btn primary">Abrir d√≠a</button>
          <span class="pill"><span class="dot"></span> 1h aprox</span>
        </div>
      `;
      card.querySelector("button").onclick = () => openSession(profile, s.id);
      home.appendChild(card);
    });

    updateKPIs(profile);
  }

  // ============================
  // COMPLETAR SESI√ìN
  // ============================
  function markSessionComplete(profile, sessionId){
    const week = getWeek(profile);
    const session = getProfileSessions(profile).find(s => s.id === sessionId);
    if (!session) return;

    session.exercises.forEach(ex => {
      localStorage.setItem(checkKey(profile, week, sessionId, ex.id), "1");
    });

    openSession(profile, sessionId);
  }

  // ============================
  // SESSION
  // ============================
  function openSession(profile, sessionId){
    ACTIVE_SESSION_ID = sessionId;

    const home = $("homeView");
    const sessView = $("sessionView");
    const table = $("exerciseTable");

    home.innerHTML = "";
    sessView.classList.remove("hidden");

    const week = getWeek(profile);
    const session = getProfileSessions(profile).find(s => s.id === sessionId);
    if (!session) return;

    $("sessionTitle").textContent = `${session.dayLabel} ¬∑ ${session.title}`;
    $("sessionObjective").textContent = `Objetivo: ${session.objective} ¬∑ Semana ${week}`;
    $("sessionTimeTag").textContent = session.approx || "~60 min";
    $("progressionHint").innerHTML = `üéØ <b>Progresi√≥n sugerida:</b> ${getProgressionText(profile, week)}`;

    $("completeSessionBtn").onclick = () => markSessionComplete(profile, sessionId);

    table.innerHTML = "";

    session.exercises.forEach(e=>{
      const k = checkKey(profile, week, sessionId, e.id);
      const checked = localStorage.getItem(k) === "1";
      const restSeconds = restToSeconds(e.rest);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input class="check" type="checkbox" ${checked ? "checked":""}></td>

        <td>
          <div class="row between" style="gap:10px">
            <div style="font-weight:900">${e.name}</div>
            <button class="timerBtn" title="Cron√≥metro de descanso">‚è±</button>
          </div>

          <div class="small muted" style="margin-top:4px; line-height:1.35">${e.desc || ""}</div>

          <details>
            <summary>Notas t√©cnicas</summary>
            <div class="small muted" style="margin-top:6px; line-height:1.45">
              <b>Claves:</b> ${e.keys || "T√©cnica limpia, control y explosi√≥n donde corresponda."}<br>
              <b>Errores comunes:</b> ${e.errors || "Compensar con espalda, rodilla colapsa, ir al fallo sin necesidad."}
            </div>
          </details>
        </td>

        <td>${e.sets ?? "‚Äî"}</td>
        <td>${e.reps ?? "‚Äî"}</td>
        <td>${e.rest ?? "‚Äî"}</td>
        <td><a href="${e.url}" target="_blank" rel="noopener">Ver</a></td>
      `;

      tr.querySelector("input").addEventListener("change", (ev)=>{
        localStorage.setItem(k, ev.target.checked ? "1" : "0");
        updateKPIs(profile);
      });

      tr.querySelector(".timerBtn").addEventListener("click", () => {
        openTimer(e.name, restSeconds);
      });

      table.appendChild(tr);
    });

    updateKPIs(profile);
  }

  // ============================
  // RESET SEMANA
  // ============================
  function resetWeek(profile){
    const w = getWeek(profile);
    const prefix = `mpwa_${profile}_check_w${w}_`;
    Object.keys(localStorage).forEach(key=>{
      if (key.startsWith(prefix)) localStorage.removeItem(key);
    });
    alert(`Semana ${w} reseteada para ${PROFILES[profile].name}`);
    renderHome(profile);
  }

  // ============================
  // INIT
  // ============================
  document.addEventListener("DOMContentLoaded", () => {
    try {
      newMotivation();
      $("newMotivationBtn").addEventListener("click", newMotivation);

      fillProfileSelect();
      initTimerUI();

      $("enterBtn").addEventListener("click", () => {
        const id = $("profileSelect").value;
        if (!id) return;

        ACTIVE_PROFILE = id;
        setActiveProfile(id);
        setProfilePill(id);

        if (!localStorage.getItem(weekKey(id))) setWeek(id, 1);
        fillWeekSelect(id);

        showAppView();
        newMotivation();
        renderHome(id);
      });

      $("switchProfileBtn").addEventListener("click", () => {
        showProfileView();
        const saved = getActiveProfile();
        if (saved && PROFILES[saved]){
          $("profileSelect").value = saved;
          $("profileInfo").textContent = PROFILES[saved].info;
        }
      });

      $("homeBtn").addEventListener("click", () => {
        if (!ACTIVE_PROFILE) ACTIVE_PROFILE = getActiveProfile();
        if (ACTIVE_PROFILE) renderHome(ACTIVE_PROFILE);
      });

      $("backBtn").addEventListener("click", () => {
        if (!ACTIVE_PROFILE) ACTIVE_PROFILE = getActiveProfile();
        if (ACTIVE_PROFILE) renderHome(ACTIVE_PROFILE);
      });

      $("resetBtn").addEventListener("click", () => {
        if (!ACTIVE_PROFILE) ACTIVE_PROFILE = getActiveProfile();
        if (ACTIVE_PROFILE) resetWeek(ACTIVE_PROFILE);
      });

      $("weekSelect").addEventListener("change", (e) => {
        if (!ACTIVE_PROFILE) ACTIVE_PROFILE = getActiveProfile();
        if (!ACTIVE_PROFILE) return;
        setWeek(ACTIVE_PROFILE, Number(e.target.value || "1"));
        renderHome(ACTIVE_PROFILE);
      });

      // Auto-entrar
      const saved = getActiveProfile();
      if (saved && PROFILES[saved]){
        ACTIVE_PROFILE = saved;
        setProfilePill(saved);
        if (!localStorage.getItem(weekKey(saved))) setWeek(saved, 1);
        fillWeekSelect(saved);
        showAppView();
        renderHome(saved);
      } else {
        showProfileView();
        $("profilePill").innerHTML = `<span class="dot"></span> Perfil: ‚Äî`;
        $("kpiProfile").textContent = "‚Äî";
        $("kpiWeek").textContent = "‚Äî";
        $("kpiWeeklyPct").textContent = "‚Äî";
      }

    } catch (err) {
      console.error(err);
      showError("Error en JavaScript: " + (err?.message || err));
    }
  });
})();
</script>
</body>
</html>
